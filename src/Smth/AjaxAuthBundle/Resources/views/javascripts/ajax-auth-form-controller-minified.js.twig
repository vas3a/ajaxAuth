<script type="text/javascript">(function(){var a,b,c,d,e,f=function(a,b){return function(){return a.apply(b,arguments)}},g={}.hasOwnProperty,h=function(a,b){function d(){this.constructor=a}for(var c in b)g.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};e=document,a=function(){function a(){this.login_failed=f(this.login_failed,this),this.login_succeded=f(this.login_succeded,this),this.server_responded=f(this.server_responded,this),this.form=$("form#ajax-login"),this.username=this.form.find("input[name=_username]"),this.password=this.form.find("input[name=_password]")}return a.prototype.server_responded=function(a){return this[a.result](a),this.form.trigger("done")},a.prototype.login_succeded=function(a){return this.redirect(a.redirect_url)},a.prototype.login_failed=function(a){return this.invalid($(this.username,this.password),a.message)},a.prototype.redirect=function(a){return window.location.href=a},a.prototype.invalid=function(a,b){return a.trigger({type:"invalid",message:b})},a}(),b=function(a){function b(){this._ajax=f(this._ajax,this),this._onSubmit=f(this._onSubmit,this),this._beforeSubmit=f(this._beforeSubmit,this),b.__super__.constructor.apply(this,arguments),this.submitURL=this.form.attr("action"),this.form.bind("submit",this._onSubmit)}return h(b,a),b.prototype._beforeSubmit=function(a){return this.username.val().length?this.password.val().length?a.apply(this):this.invalid(this.password,"Type your password"):this.invalid(this.username,"Type your username")},b.prototype._onSubmit=function(a){return a.preventDefault(),this._beforeSubmit(this._ajax)},b.prototype._ajax=function(){return this.form.trigger("loading"),$.ajax({url:this.submitURL,type:"POST",dataType:"json",data:{_username:this.username.val(),_password:this.password.val()},success:this.server_responded})},b}(a),c=function(a){function b(a,c){var d=this;this.loginRoute=a,this.appId=c,this.fbReady=f(this.fbReady,this),this.loadFBApi=f(this.loadFBApi,this),this.fbCallback=f(this.fbCallback,this),b.__super__.constructor.apply(this,arguments),this.loadFBApi(),this.fBtn=$("#ajax-fb-btn"),this.fBtn.bind("click",function(){return FB.login(d.fbCallback,{scope:"email"})})}return h(b,a),b.prototype.fbCallback=function(a){return"connected"===a.status?$.ajax({url:this.loginRoute,type:"POST",dataType:"json",data:{token:a.authResponse.accessToken},success:this.server_responded}):void 0},b.prototype.loadFBApi=function(){var a,b,c;if(window.facebookReady!==!0){if(e.getElementById(a="facebook-jssdk"))return;return c=e.getElementsByTagName("script")[0],b=e.createElement("script"),b.id=a,b.async=!0,b.src="//connect.facebook.net/en_US/all.js",c.parentNode.insertBefore(b,c),window.fbAsyncInit=this.fbReady}},b.prototype.fbReady=function(){return FB.init({appId:this.appId,status:!0,cookie:!0,xfbml:!0}),window.facebookReady=!0,$(window).trigger("facebookReady")},b}(b),d=function(a){function b(a,c){var d=this;this.loginRoute=a,this.clientId=c,this.loadGApi=f(this.loadGApi,this),this.renderSignInButton=f(this.renderSignInButton,this),this.doLogin=f(this.doLogin,this),this.saveResponse=f(this.saveResponse,this),b.__super__.constructor.apply(this,arguments),this.loadGApi(),this.gBtn=$("#ajax-g-btn"),this.gBtn.bind("click",function(){return d.login=!0})}return h(b,a),b.prototype.saveResponse=function(a){return this.response=a,this.login?this.doLogin():void 0},b.prototype.doLogin=function(){var a;return a=this.response,null!=a.code&&a.code&&a.state===this.token&&null==a.error?$.ajax({url:this.loginRoute,type:"POST",dataType:"json",data:{token:a.access_token},success:this.server_responded}):void 0},b.prototype.renderSignInButton=function(){return this.googleBtn={callback:this.saveResponse,clientid:this.clientId+".apps.googleusercontent.com",cookiepolicy:"single_host_origin",requestvisibleactions:"http://schemas.google.com/AddActivity",scope:"https://www.googleapis.com/auth/userinfo.email https://www.googleapis.com/auth/userinfo.profile",state:this.token="test123_merely_is_a_token"},gapi.signin.render("ajax-g-btn",this.googleBtn)},b.prototype.loadGApi=function(){var a,b,c=this;return window.gApiReady!==!0?(window.gApiReady=function(){return window.gApiReady=!0,c.renderSignInButton()},b=e.createElement("script"),b.type="text/javascript",b.async=!0,b.src="https://apis.google.com/js/client:plusone.js?onload=gApiReady",a=e.getElementsByTagName("script")[0],a.parentNode.insertBefore(b,a)):void 0},b}(b),new b{% if includeFacebook %},new c("{{facebookConnectUrl}}","{{facebookAppId}}"){% endif %}{% if includeGoogle %},new d("{{googleConnectUrl}}","{{googleClientId}}"){% endif %}}).call(this);</script>